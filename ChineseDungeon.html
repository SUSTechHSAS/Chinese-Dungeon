<!DOCTYPE html>
<html lang="zh-cmn-Hans">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=0.1" />
		<title>Dungeon Game</title>
		<link rel="stylesheet" href="assets/css/chinese-dungeon.css">
	</head>
	<body class="初始化">
		<div id="effectsContainer"></div>
		<div id="大地图遮罩">
    <div id="大地图窗口">
        <div class="大地图头部">
            <h2 id="大地图楼层标题" style="color:white;">地牢地图</h2>
            <button id="关闭大地图按钮" class="关闭按钮">×</button>
        </div>
        <div id="大地图画布容器">
             <canvas id="大地图画布"></canvas>
             <div id="大地图信息" class="大地图信息"></div>
        </div>
        <div class="大地图控制栏">
            <button id="大地图上一层按钮" class="菜单按钮" title="上一层">🔼</button>
            <button id="大地图下一层按钮" class="菜单按钮" title="下一层">🔽</button>
            <button id="大地图缩放放大按钮" class="菜单按钮" title="放大">+</button>
            <button id="大地图缩放缩小按钮" class="菜单按钮" title="缩小">-</button>
            <button id="大地图居中按钮" class="菜单按钮" title="居中玩家">🎯</button>
            <button id="大地图标记模式按钮" class="菜单按钮" title="标记模式">📌</button>
            <button id="大地图传送按钮" class="菜单按钮" title="传送" style="display: none;">🚀</button>
        </div>
    </div>
</div>
		<div id="设置窗口遮罩" style="display: none;">
			<div id="设置窗口">
				<div class="设置标题行">
					<h2 class="设置标题">游戏设置</h2>
					<button id="关闭设置窗口按钮" class="关闭按钮">×</button>
				</div>
				<div class="设置内容">
					<div class="设置分区">
						<h3>热键绑定</h3>
						<div id="热键绑定容器" class="热键绑定网格">
						</div>
					</div>
					<div class="设置分区">
						<h3>操控</h3>
						<div class="设置行">
							<label for="方向键大小滑块" class="设置标签">方向键大小</label>
							<input type="range" id="方向键大小滑块" min="8" max="20" value="13">
							<span id="方向键大小值">13vmin</span>
						</div>
						<div class="设置行">
							<label class="设置标签">显示方向键</label>
							<button id="显示方向键切换" class="设置切换按钮"></button>
						</div>
						<div class="设置行">
							<label class="设置标签">禁用点击寻路</label>
							<button id="禁用点击寻路切换" class="设置切换按钮"></button>
						</div>
						<div class="设置行">
							<label for="移动速度滑块" class="设置标签">长按移动速度</label>
							<input type="range" id="移动速度滑块" min="0" max="200" value="100" step="5">
							<span id="移动速度值">100ms</span>
						</div>
						<div class="设置行">
							<label class="设置标签">强制手机模式</label>
							<button id="手机模式切换" class="设置切换按钮"></button>
						</div>
						<div class="设置行">
							<label class="设置标签">受伤时击退</label>
							<button id="受伤击退切换" class="设置切换按钮"></button>
						</div>
					</div>
					<div class="设置分区">
						<h3>显示</h3>
						<div class="设置行">
							<label class="设置标签">动画模式</label>
							<button id="动画模式切换" class="设置切换按钮"></button>
						</div>
						<div class="设置行">
							<label class="设置标签">文本模式</label>
							<button id="文本模式切换" class="设置切换按钮"></button>
						</div>
						<div class="设置行">
							<label for="相机视野滑块" class="设置标签">相机视野大小</label>
							<input type="range" id="相机视野滑块" min="5" max="30" value="15">
							<span id="相机视野值">15</span>
						</div>
						<div class="设置行">
							<label for="小地图大小滑块" class="设置标签">小地图大小</label>
							<input type="range" id="小地图大小滑块" min="0" max="250" value="150">
							<span id="小地图大小值">150px</span>
						</div>
					</div>
				</div>
				<div class="设置页脚">
					<button id="保存设置按钮" class="菜单按钮">保存并应用</button>
				</div>
			</div>
		</div>
		<canvas id="dungeonCanvas"></canvas>
		<div id="结算界面遮罩" style="display: none;">
			<div id="结算粒子容器"></div>
			<div class="结算界面">
				<h2 class="结算标题"></h2>
				<div id="结局评级" class="结局评级"></div>
				<p id="结束评语" class="结束评语"></p>
				<div class="结算统计容器">
				</div>
				<div class="通关凭证容器">
					<span class="凭证标签">通关凭证</span>
					<div class="凭证码" id="通关凭证码"></div>
				</div>
				<div class="结算按钮容器">
					<button id="结算返回主菜单按钮" class="菜单按钮">返回主菜单</button>
				</div>
			</div>
		</div>
		<div id="创意关卡浏览器" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: linear-gradient(160deg, #0a0a0a 0%, #1a1a1a 100%); z-index: 10003; color: #e0e0e0; font-family: 'HarmonyOS Sans SC', 'MiSans', system-ui, 'color-emoji'; flex-direction: column; align-items: center; justify-content: flex-start; padding-top: 5vh; box-sizing: border-box; overflow-y: auto;">
			<button id="返回游戏模式选择按钮" style="position: fixed;
				top: 20px;
				left: 20px;
				z-index: 10004;
				width: 45px;
				height: 45px;
				border-radius: 50%;
				background: rgba(40, 40, 40, 0.7);
				border: 1px solid #4caf50;
				color: #e0e0e0;
				font-size: 24px;
				font-weight: bold;
				display: flex;
				align-items: center;
				justify-content: center;
				cursor: pointer;
				transition: all 0.3s ease;
				padding: 0;
				line-height: 1;
				box-shadow: 0 2px 8px rgba(0,0,0,0.5);
				backdrop-filter: blur(3px);">←</button>
			<div id="关卡详情界面" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: linear-gradient(160deg, #0a0a0a 0%, #1a1a1a 100%); z-index: 10004; color: #e0e0e0; font-family: 'HarmonyOS Sans SC', 'MiSans', system-ui, 'color-emoji'; flex-direction: column; align-items: center; justify-content: flex-start; padding: 5vh 2vh; box-sizing: border-box; overflow-y: auto;">
				<div id="关卡详情容器" style="display: flex; flex-wrap: wrap; width: 95%; max-width: 900px; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px; gap: 20px;">
					<div id="关卡详情_左侧" style="flex: 1; min-width: 280px; display: flex; flex-direction: column;">
						<h2 id="详情_标题" style="font-size: 2rem; color: #66bb6a; margin: 0 0 10px 0; word-break: break-all;"></h2>
						<div style="color: #aaa; border-bottom: 1px solid #444; padding-bottom: 15px; margin-bottom: 15px;">
							<span id="详情_作者"></span> | <span id="详情_版本"></span>
						</div>
						<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; font-size: 1.1em; margin-bottom: 20px;">
							<span id="详情_游玩次数" title="游玩次数">👁️ 0</span>
							<span id="详情_通关次数" title="通关人数">🏆 0</span>
							<span id="详情_赞" title="赞">👍 0</span>
							<span id="详情_踩" title="踩">👎 0</span>
						</div>
						<div id="详情_操作按钮容器" style="display: flex; flex-direction: column; gap: 1rem; margin-top: auto;">
						</div>
					</div>
					<div id="关卡详情_右侧" style="flex: 1; min-width: 280px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
						<h4 style="margin: 0 0 10px 0; color: #888;">关卡预览</h4>
						<canvas id="详情_小地图" style="width: 100%; max-width: 300px; aspect-ratio: 1 / 1; border: 1px solid #444; border-radius: 8px; background: #000;"></canvas>
					</div>
				</div>
				<button id="返回浏览器按钮" class="菜单按钮" style="margin-top: 1.5rem; margin-bottom: 2vh; border-color: #aaa; background: rgba(150,150,150,0.1); flex-shrink: 0;">返回工坊</button>
			</div>
			<h2 style="font-size: 2.5rem; color: #4caf50; margin-bottom: 2rem;">创意工坊</h2>
			<div id="上传区域" style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 8px; margin-bottom: 20px; width: 80%; max-width: 500px; display: flex; flex-direction: column; gap: 10px;">
				<h3 style="margin: 0; text-align: center; color: #66bb6a;">上传你的关卡</h3>
				<input type="file" id="关卡文件输入" accept=".json" style="color: #ccc; background: #333; border: 1px solid #555; border-radius: 4px; padding: 8px;">
				<input type="text" id="关卡标题输入" placeholder="关卡标题" style="background: #333; border: 1px solid #555; color: #fff; padding: 8px; border-radius: 4px;">
				<input type="text" id="关卡作者输入" placeholder="作者" style="background: #333; border: 1px solid #555; color: #fff; padding: 8px; border-radius: 4px;">
				<input type="text" id="关卡标签输入" placeholder="标签（逗号分隔）" style="background: #333; border: 1px solid #555; color: #fff; padding: 8px; border-radius: 4px;">
				<input type="password" id="关卡上传密码输入" placeholder="设置一个删除密码" style="background: #333; border: 1px solid #555; color: #fff; padding: 8px; border-radius: 4px;">
				<button id="上传关卡按钮" class="菜单按钮" style="min-width: unset; width: 100%;">上传关卡</button>
			</div>
			<hr style="width: 80%; border-color: #444;">
			<div id="搜索与列表区域" style="width: 80%; max-width: 700px; margin-top: 20px; flex-grow: 1; display: flex; flex-direction: column;">
				<div id="搜索行" style="display: flex; gap: 10px; margin-bottom: 20px;">
					<input type="text" id="搜索关卡输入" placeholder="搜索标题..." style="flex-grow: 1; background: #333; border: 1px solid #555; color: #fff; padding: 10px; border-radius: 4px;">
					<button id="搜索关卡按钮" class="菜单按钮" style="min-width: unset; padding: 10px 20px;">搜索/刷新</button>
				</div>
				<ul id="关卡列表" style="list-style: none; padding: 0; margin: 0 0 5vh 0; overflow-y: auto; max-height: none;">
				</ul>
			</div>
		</div>
		<div id="游戏模式选择菜单" style="display: none;">
			<div id="游戏模式内容">
				<h2 id="游戏模式标题">选择游戏模式</h2>
				<div id="游戏模式选项">
					<button id="无尽地牢按钮" class="菜单按钮">无尽地牢</button>
					<button id="无尽洞穴按钮" class="菜单按钮">无尽洞穴</button>
					<button id="无尽迷宫按钮" class="菜单按钮">无尽迷宫</button>
					<button id="创意关卡按钮" class="菜单按钮">创意工坊</button>
				</div>
				<button id="返回主菜单按钮" class="菜单按钮" style="margin-top: 2rem; border-color: #aaa; background: rgba(150,150,150,0.1);">返回主菜单</button>
			</div>
		</div>
		<div id="职业选择遮罩">
			<div id="职业选择窗口" class="重铸弹窗">
				<h2 class="职业选择标题">开始新的冒险</h2>
				<div class="设置项目">
					<label for="游戏种子输入" style="margin-bottom: 5px;">输入种子 (留空则随机)</label>
					<div class="种子输入容器">
						<input type="text" id="游戏种子输入" placeholder="输入自定义种子...">
						<button id="每日挑战按钮" title="每日挑战">📅</button>
						<button id="种子筛选器按钮" title="种子筛选器">🔍</button>
					</div>
				</div>
				<h3 style="font-size: 1.2em; color: #e0e0e0; border-bottom: 1px dashed #555; padding-bottom: 8px; margin: 20px 0 15px 0;">选择你的职业</h3>
				<div id="职业选项容器" class="职业选项容器">
				</div>
				<div class="职业选择页脚">
					<button id="返回模式选择按钮" class="菜单按钮" style="background: rgba(150,150,150,0.1); border-color: #aaa; flex: 1;">返回</button>
					<button id="开始游戏自定义按钮" class="菜单按钮" style="flex: 2;">踏上征程</button>
				</div>
			</div>
		</div>
		<input type="file" id="创意关卡文件输入" accept=".json" style="display: none" />
		<div id="楼层选择遮罩" class="重铸遮罩" style="display: none; z-index: 10006;">
			<div id="楼层选择窗口" class="重铸弹窗">
				<div class="重铸弹窗-header">
					<h3>选择要导入的楼层</h3>
					<button class="关闭按钮" id="关闭楼层选择按钮">×</button>
				</div>
				<div id="楼层选择列表" class="重铸弹窗-items" style="max-height: none; display: grid;">
				</div>
			</div>
		</div>
		<div id="图鉴分区选择遮罩" class="重铸遮罩" style="display: none; z-index: 10005">
			<div id="图鉴分区选择窗口">
				<div class="重铸弹窗-header">
					<h3>选择图鉴分区</h3>
					<button class="关闭按钮" id="关闭图鉴选择按钮">×</button>
				</div>
				<div id="图鉴分区列表容器" class="重铸弹窗-items" style="
					max-height: 60vh;
					grid-template-columns: repeat(
					auto-fill,
					minmax(150px, 1fr)
					);
					"></div>
			</div>
		</div>
		<button id="返回编辑器按钮" class="菜单按钮 不可选中" style="display: none; position: fixed; top: 5px; right: 5px; z-index: 10006; min-width: 120px; padding: 8px 15px; font-size: 0.9em; background: #f44336;">返回编辑器</button>
		<div id="编辑器工具栏" class="不可选中" style="position: fixed; top: 5px; right: 5px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 8px; z-index: 1000; display: flex; flex-direction: column; gap: 8px;">
			<button id="全局设置按钮" class="菜单按钮" style="min-width: 120px; padding: 8px 15px; font-size: 0.9em;">全局/地图设置</button>
			<button id="编辑器撤回按钮" class="菜单按钮" style="min-width: 120px; padding: 8px 15px; font-size: 0.9em;">撤回</button>
			<button id="编辑器重做按钮" class="菜单按钮" style="min-width: 120px; padding: 8px 15px; font-size: 0.9em;">重做</button>
			<button id="编辑器游玩按钮" class="菜单按钮" style="min-width: 120px; padding: 8px 15px; font-size: 0.9em; background: #2196f3;">开始游玩</button>
		</div>
		<div id="笔刷工具容器" class="不可选中" style="display: none;">
			<div class="设置项目" style="gap: 8px;">
				<label for="编辑器工具选择" style="color: #ccc;">工具模式</label>
				<select id="编辑器工具选择" style="background: #333; border: 1px solid #555; color: #fff; padding: 5px; border-radius: 4px; width: 100%;">
					<option value="单个">单个放置</option>
					<option value="笔刷">笔刷</option>
					<option value="油漆桶">油漆桶</option>
				</select>
			</div>
			<div id="笔刷设置容器" style="display: none; flex-direction: column; gap: 8px;">
				<div class="设置项目" style="gap: 8px;">
					<label for="笔刷形状选择" style="color: #ccc;">笔刷形状</label>
					<select id="笔刷形状选择" style="background: #333; border: 1px solid #555; color: #fff; padding: 5px; border-radius: 4px; width: 100%;">
						<option value="圆形">圆形</option>
						<option value="矩形">矩形</option>
					</select>
				</div>
				<div class="设置项目" style="gap: 8px;">
					<label for="笔刷尺寸滑块" style="color: #ccc;">笔刷尺寸: <span id="笔刷尺寸值">3</span></label>
					<input type="range" id="笔刷尺寸滑块" min="1" max="15" value="3" style="width: 100%;">
				</div>
			</div>
		</div>
		<div id="编辑器属性面板遮罩" class="重铸遮罩" style="display: none; z-index: 10006;">
			<div id="编辑器属性面板" class="重铸弹窗" style="max-width: 500px; max-height: 80vh; overflow-y: scroll;">
				<div class="重铸弹窗-header">
					<h3 id="属性面板标题">编辑属性</h3>
					<button class="关闭按钮" id="关闭属性面板按钮">×</button>
				</div>
				<div id="属性面板内容" class="重铸弹窗-items" style="display: block; padding: 15px;"></div>
				<div style="display: flex; justify-content: space-between; padding: 10px 0;">
					<button id="删除对象按钮" class="菜单按钮" style="background: #c62828; border-color: #e53935; min-width: 100px; padding: 8px 15px; font-size: 0.9em;">删除</button>
					<button id="保存属性按钮" class="菜单按钮" style="min-width: 100px; padding: 8px 15px; font-size: 0.9em;">应用</button>
				</div>
			</div>
		</div>
		<div id="全局设置窗口" class="重铸弹窗" style="max-width: 500px; max-height: 80vh; overflow-y: scroll; display: none;">
			<div class="重铸弹窗-header">
				<h3>全局/地图设置</h3>
				<button class="关闭按钮" id="关闭全局设置按钮">×</button>
			</div>
			<div id="全局设置内容" class="重铸弹窗-items" style="display: flex; flex-direction: column; gap: 15px; padding: 15px;">
				<h4 style="margin-bottom: -5px; border-bottom: 1px solid #444; padding-bottom: 5px;">地图操作</h4>
				<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
					<button id="编辑器保存按钮" class="菜单按钮" style="padding: 8px 15px; font-size: 0.9em; margin:0; min-width:0px;">导出地图</button>
					<button id="编辑器加载按钮" class="菜单按钮" style="padding: 8px 15px; font-size: 0.9em; margin:0; min-width:0px;">导入地图</button>
					<button id="编辑器设置起点按钮" class="菜单按钮" style="padding: 8px 15px; font-size: 0.9em; margin:0; min-width:0px;">设置起点</button>
					<button id="编辑器模板按钮" class="菜单按钮" style="padding: 8px 15px; font-size: 0.9em; margin:0; min-width:0px;">生成地牢模板</button>
					<button id="编辑器洞穴模板按钮" class="菜单按钮" style="padding: 8px 15px; font-size: 0.9em; margin:0; min-width:0px;">生成洞穴模板</button>
					<button id="编辑器迷宫模板按钮" class="菜单按钮" style="padding: 8px 15px; font-size: 0.9em; margin:0; min-width:0px;">生成迷宫模板</button>
				</div>
				<h4 style="margin-top: 15px; border-bottom: 1px solid #444; padding-top: 10px;">初始状态</h4>
				<div style="display: flex; gap: 10px; flex-direction: column;">
					<div class="设置项目">
						<label for="设置_初始生命值">初始生命值</label>
						<input type="number" id="设置_初始生命值" value="100" min="1">
					</div>
					<div class="设置项目">
						<label for="设置_初始能量值">初始能量值</label>
						<input type="number" id="设置_初始能量值" value="100" min="0">
					</div>
					<div class="设置项目">
						<label for="设置_初始背包容量">初始背包容量</label>
						<input type="number" id="设置_初始背包容量" value="12" min="1" max="24">
					</div>
					<div class="设置项目">
						<label for="设置_初始移动步数">初始移动步数</label>
						<input type="number" id="设置_初始移动步数" value="1" min="1">
					</div>
					<div class="设置项目">
						<label for="设置_初始攻击加成">初始攻击加成</label>
						<input type="number" id="设置_初始攻击加成" value="0" min="0">
					</div>
					<div class="设置项目">
						<label for="设置_初始防御加成">初始防御加成</label>
						<input type="number" id="设置_初始防御加成" value="0" min="0">
					</div>
				</div>
				<h4 style="margin-top: 15px; border-bottom: 1px solid #444; padding-top: 10px;">胜利/失败条件 (0为不限制)</h4>
				<div style="display: flex; flex-direction: column; gap: 10px;">
					<div class="设置项目">
						<label for="设置_回合数限制">回合数限制</label>
						<input type="number" id="设置_回合数限制" value="0" min="0">
					</div>
					<div class="设置项目">
						<label for="设置_伤害限制">总受伤限制</label>
						<input type="number" id="设置_伤害限制" value="0" min="0">
					</div>
					<div class="设置项目">
						<label for="设置_生命下限">最低生命值</label>
						<input type="number" id="设置_生命下限" value="0" min="0">
					</div>
					<div class="设置项目">
						<label for="设置_死亡次数限制">死亡次数限制</label>
						<input type="number" id="设置_死亡次数限制" value="0" min="0">
					</div>
					<div class="设置项目">
						<label for="设置_清除所有怪物">清除所有怪物</label>
						<input type="checkbox" id="设置_清除所有怪物">
					</div>
				</div>
				<h4 style="margin-top: 15px; border-bottom: 1px solid #444; padding-top: 10px;">编辑器设置</h4>
				<div class="设置项目">
					<label for="设置_禁用传送菜单">禁用传送菜单</label>
					<input type="checkbox" id="设置_禁用传送菜单">
				</div>
				<div class="设置项目">
					<label for="设置_禁用大地图">禁用大地图</label>
					<input type="checkbox" id="设置_禁用大地图">
				</div>
				<div class="设置项目">
					<label for="设置_相机视野大小">视野大小 (仅单次生效)</label>
					<input type="number" id="设置_相机视野大小" value="15" min="5" max="50">
				</div>
				<div class="设置项目">
					<label for="设置_诡魅天气怪物层级">诡魅天气怪物层级</label>
					<input type="number" id="设置_诡魅天气怪物层级" value="1" min="0">
				</div>
				<div class="设置项目">
					<label for="设置_奖励物品层级">奖励物品层级</label>
					<input type="number" id="设置_奖励物品层级" value="1" min="0">
				</div>
				<h4 style="grid-column: 1 / -1; margin-top: 15px; border-bottom: 1px solid #444; padding-top: 10px;">全局天气</h4>
				<div id="天气选择容器" class="天气选择容器">
				</div>
			</div>
			<div style="display: flex; justify-content: flex-end; padding: 10px;">
				<button id="保存全局设置按钮" class="菜单按钮" style="min-width: 100px; padding: 8px 15px; font-size: 0.9em;">应用</button>
			</div>
		</div>
		<div id="主菜单容器">
			<h1 id="游戏标题">中文地牢</h1>
			<div id="菜单选项">
				<button id="新建游戏按钮" class="菜单按钮">开始新游戏</button>
				<button id="读取存档按钮" class="菜单按钮">读取存档</button>
				<button id="图鉴按钮" class="菜单按钮">图鉴</button>
				<button id="地图编辑器按钮" class="菜单按钮">地图编辑器</button>
				<button id="读凭证按钮" class="菜单按钮">读取凭证</button>
				<button id="设置按钮_主菜单" class="菜单按钮">设置</button>
			</div>
			<div id="版本信息">游戏似乎崩溃了!请尝试反馈!</div>
		</div>
		<div id="教程提示窗口" class="教程提示窗口">
			<p id="教程提示内容"></p>
			<button class="关闭按钮" onclick="关闭教程提示()">我知道了</button>
		</div>
		<button id="回放教程按钮" class="control-btn" onclick="打开教程回放窗口()" style="display: block; height: 5vmin; font-size: 0.8em">
		回看教程
		</button>
		<button id="跳过教程按钮" class="control-btn" onclick="跳过教程()">
		跳过
		</button>
		<div id="教程回放窗口" class="教程提示窗口">
			<p id="教程回放内容"></p>
			<div class="教程导航">
				<button id="上一页教程按钮" class="关闭按钮" style="margin-left: unset">
				上一页
				</button>
				<span id="教程页码" style="margin-left: auto">1 / 1</span>
				<button id="下一页教程按钮" class="关闭按钮">下一页</button>
			</div>
			<button class="关闭按钮" onclick="关闭教程回放窗口()">关闭</button>
		</div>
		<div id="扣血特效" class="扣血遮罩"></div>
		<div id="怪物指示器容器"></div>
		<div class="装备栏">
			<div class="装备槽" id="装备槽1"></div>
			<div class="装备槽" id="装备槽2"></div>
			<div class="装备槽" id="装备槽3"></div>
			<div class="装备槽" id="装备槽4"></div>
			<div class="装备槽" id="装备槽5"></div>
			<div class="装备槽" id="装备槽6"></div>
			<div class="装备槽" id="装备槽7"></div>
		</div>
		<div class="control-pad 不可选中" style="z-index: 1000">
			<div class="control-row">
				<div class="control-btn directional-btn" id="upBtn">↑</div>
			</div>
			<div class="control-row">
				<div class="control-btn directional-btn" id="leftBtn">←</div>
				<div class="control-btn directional-btn" id="rightBtn">→</div>
			</div>
			<div class="control-row">
				<div class="control-btn directional-btn" id="downBtn">↓</div>
			</div>
		</div>
		<div class="control-pad-actions 不可选中" style="z-index: 1000">
			<div class="control-row">
				<button id="背包按钮" onclick="切换背包显示()" class="control-btn">🎒</button>
				<button id="互动按钮" onclick="尝试互动()" class="control-btn">⚡</button>
				<button id="hudToggle" class="control-btn" style="position: absolute; bottom: 110%" onclick="处理HUD切换按钮点击()">👁️</button>
			</div>
		</div>
		<div class="settings-container 不可选中" style="z-index: 999">
			<div class="control-row">
				<button id="设置按钮" class="control-btn" onclick="切换设置菜单()" style="font-size: 1em">⚙️</button>
			</div>
		</div>
		<div id="gameInfoOverlay" class="game-info-overlay">
			<div id="gameInfoWindow" class="game-info-window">
				<div class="game-info-header">
					<h2>关于 中文地牢</h2>
					<button id="closeGameInfoBtn" class="关闭按钮">×</button>
				</div>
				<div id="gameInfoContent" class="game-info-content">
					<h3>灵感来源</h3>
					<p><strong>《Pixel Dungeon》:</strong> 未知道具系统、职业系统、陷阱</p>
					<p><strong>《Super Mario Maker》:</strong> 地图编辑器</p>
					<p><strong>《NetHack》:</strong> 道具融合系统</p>
					<p><strong>《Rogue》:</strong> 程序生成地牢</p>
					<h3>更新日志 <span class="info-version-tag">v</span></h3>
					<ul>
						<li><strong>新功能:</strong> 增加了死灵法杖。</li>
						<li><strong>修复:</strong> 修复了若干问题。</li>
					</ul>
					
					<h3>游戏简介</h3>
					<p>《中文地牢》是一款基于字符和Emoji的轻量级Roguelike地牢探索游戏。在这个由未知构成的世界里，每一次冒险都是独一无二的。</p>
				</div>
			</div>
		</div>
		<div id="浮动提示框"></div>
		<div id="配方书遮罩" class="重铸遮罩" style="display: none; z-index: 10005">
			<div id="配方书窗口" style="
				position: fixed;
				left: 50%;
				top: 50%;
				transform: translate(-50%, -50%);
				background: #1a1a1ae6;
				border: 2px solid #4a4a4a;
				border-radius: 12px;
				padding: 20px;
				width: 80vmin;
				max-width: 700px;
				color: #e0e0e0;
				z-index: 10006;
				box-shadow: 0 0 30px #00000080;
				animation: 弹窗浮现 0.3s cubic-bezier(0.4, 0, 0.2, 1);
				transition: opacity 0.3s ease,
				transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
				display: flex;
				flex-direction: column;
				max-height: 85vh;
				">
				<div class="重铸弹窗-header" style="border-bottom: 1px solid #4caf50">
					<h3 style="color: #4caf50">配方书</h3>
					<button class="关闭按钮" id="关闭配方书按钮" style="color: #4caf50">
					×
					</button>
				</div>
				<div id="配方书内容容器" class="重铸弹窗-items" style="
					max-height: calc(85vh - 100px);
					overflow-y: auto;
					padding: 15px;
					display: flex;
					flex-direction: column;
					gap: 10px;
					"></div>
			</div>
		</div>
		<div id="设置菜单" class="设置菜单">
			
			<button onclick="切换日志显示()">打开日志菜单</button>
			<button onclick="收纳通知()">收纳通知</button>
			<button onclick="打开传送菜单()">打开传送菜单</button>
			<button onclick="打开配方书()">配方书</button>
			<button id="导出存档按钮" onclick="导出存档()">导出存档</button>
			<button id="重置关卡按钮" onclick="重置创意关卡()" style="display: none;">重新开始关卡</button>
			<button id="自杀按钮" onclick="玩家死亡()">自杀</button>
			<button onclick="打开游戏内设置()">游戏设置</button>
			<button id="导出当前状态按钮" onclick="导出当前状态为创意关卡()" style="display: none; border-color: #ffd700;">导出当前状态(开发者)</button>
		</div>
		<div id="传送点遮罩" class="重铸遮罩" style="display: none; z-index: 10001">
			<div id="传送点菜单">
				<div class="重铸弹窗-header">
					<h3>选择传送目标</h3>
					<button class="关闭按钮" onclick="关闭传送菜单()">×</button>
				</div>
				<div id="传送点列表容器" class="重铸弹窗-items" style="max-height: 60vh"></div>
			</div>
		</div>
		<input type="file" id="存档文件输入" accept=".json" style="display: none" />
		<div id="小地图容器">
			<canvas id="小地图"></canvas>
		</div>
		<div class="hud">
			<div class="hud-item">
				<span class="hud-icon">♥️</span>
				<div class="hud-bar-container">
					<div class="hud-bar health-bar" style="width: 100%"></div>
				</div>
			</div>
			<div class="hud-item">
				<span class="hud-icon">⚡︎</span>
				<div class="hud-bar-container">
					<div class="hud-bar power-bar" style="width: 100%"></div>
				</div>
			</div>
			<div class="hud-item">
				<div class="界面文本行">
					<span class="hud-label"
						>已探索房间：<span id="roomCount">0</span></span>
				</div>
			</div>
		</div>
		<div class="背包弹窗">
			<div id="融合窗口" style="display: none">
				<div class="弹窗头部">
					<h3>物品融合</h3>
				</div>
				<div class="融合区域">
					<div class="融合区格子" id="融合区格子1"></div>
					<div class="融合区格子" id="融合区格子2"></div>
					<div class="融合区格子" id="融合区格子3"></div>
					<div class="融合区格子" id="融合区格子4"></div>
				</div>
				<div class="融合箭头">➡️</div>
				<div class="融合输出格子" id="融合输出格子"></div>
			</div>
			<div class="弹窗头部">
				<h3>
					背包 (容量：<span id="当前容量">0</span>/<span id="最大容量"
						>12</span>)
				</h3>
				<button id="背包整理按钮" title="整理背包" class="关闭按钮" style="margin-right: auto; margin-left: 10px; font-size: 1em; display: flex; align-items: center; gap: 5px;">
					<span class="整理图标">🔀</span>
					<span class="整理文本" style="display: none;">整理</span>
				</button>
				<button onclick="切换背包显示()" class="关闭按钮">×</button>
			</div>
			<div id="背包物品栏" class="物品容器"></div>
		</div>
		<div id="transitionMask" class="楼层过渡遮罩">
			<div id="floorTitle" class="层数标题"></div>
		</div>
		<div class="日志面板" id="日志面板" style="z-index: 1002">
			<div class="日志内容" id="logContent"></div>
		</div>
		<div id="交易窗口">
			<div class="窗口标题">
				神秘商人（剩余交易次数：<span id="交易次数">3</span>）
			</div>
			<div class="库存列表"></div>
			<div class="交易底部">
				<div class="玩家金币">
					持有金币：<span id="当前金币">0</span>
				</div>
				<button onclick="关闭交易窗口()" class="按钮">离开</button>
			</div>
		</div>
		<div id="收购窗口" class="游戏窗口">
			<div class="窗口标题">探险家收购</div>
			<div class="收购内容">
				<div class="收购物品列表">
					<h4>探险家想收购的物品：</h4>
					<div id="收购需求列表" class="库存列表"></div>
				</div>
				<div class="玩家背包预览">
					<h4>你拥有的（点击出售）：</h4>
					<div id="玩家可售列表" class="库存列表"></div>
				</div>
			</div>
			<div class="交易底部">
				<div class="玩家金币">
					持有金币：<span id="收购窗口金币">0</span>
				</div>
				<button onclick="关闭收购窗口()" class="按钮">告辞</button>
			</div>
		</div>
		<div id="种子筛选器遮罩" class="重铸遮罩" style="display: none; z-index: 10007;">
			<div id="种子筛选器窗口" class="重铸弹窗">
				<div class="重铸弹窗-header">
					<h3>种子筛选器</h3>
					<button class="关闭按钮" id="关闭筛选器按钮">×</button>
				</div>
				<div class="重铸弹窗-items" style="display: flex; flex-direction: column; gap: 15px; padding: 15px;">
					<div class="设置项目">
						<label for="sifter-level-input">地牢层数</label>
						<input type="number" id="sifter-level-input" value="0" min="0">
					</div>
					<div class="设置项目">
						<label for="sifter-room-id-input">房间 ID</label>
						<input type="number" id="sifter-room-id-input" value="1" min="1">
					</div>
					<div class="设置项目">
						<label for="sifter-item-select">寻找物品</label>
						<select id="sifter-item-select"></select>
					</div>
					<p id="sifter-status" style="text-align: center; color: #aaa; min-height: 2em; margin-top: 10px;"></p>
				</div>
				<div class="交易底部" style="justify-content: center;">
					<button id="开始筛选按钮" class="菜单按钮" style="min-width: 150px;">开始筛选</button>
					<button id="取消筛选按钮" class="菜单按钮" style="min-width: 150px; display: none; background: #c62828;">取消</button>
				</div>
			</div>
		</div>
<script src="https://unpkg.com/@supabase/supabase-js@2" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" defer></script>

<script src="assets/js/core/namespace.js" defer></script>
<script src="assets/js/events/bus.js" defer></script>
<script src="assets/js/utils/dom.js" defer></script>
<script src="assets/js/state/store.js" defer></script>

<script src="assets/js/core/runtime.js" defer></script>
<script src="assets/js/core/constants.js" defer></script>
<script src="assets/js/core/state.js" defer></script>
<script src="assets/js/ui/bigmap.js" defer></script>
<script src="assets/js/ui/input.js" defer></script>
<script src="assets/js/core/notify.js" defer></script>
<script src="assets/js/ui/log.js" defer></script>
<script src="assets/js/ui/inventory.js" defer></script>
<script src="assets/js/ui/teleport.js" defer></script>
<script src="assets/js/ui/settings.js" defer></script>
<script src="assets/js/ui/effects.js" defer></script>
<script src="assets/js/game/generation.js" defer></script>
<script src="assets/js/game/render.js" defer></script>
<script src="assets/js/game/trade.js" defer></script>
<script src="assets/js/game/fusion.js" defer></script>
<script src="assets/js/game/interaction.js" defer></script>
<script src="assets/js/game/loop.js" defer></script>
<script src="assets/js/game/player-actions.js" defer></script>
<script src="assets/js/game/pathfinding.js" defer></script>
<script src="assets/js/core/save.js" defer></script>
<script src="assets/js/core/bootstrap.js" defer></script>
<script src="assets/js/features/workshop.js" defer></script>
<script src="assets/js/utils/helpers.js" defer></script>
<script src="assets/js/utils/colors.js" defer></script>
<script src="assets/js/features/editor-brush.js" defer></script>
<script src="assets/js/compat/globals-shim.js" defer></script>
<script src="assets/js/main.js" defer></script>
<script src="assets/js/game/traps.js" defer></script>
</body>
</html>
<!-- 我来组成第50000行代码 刻舟求剑的来了 -->





