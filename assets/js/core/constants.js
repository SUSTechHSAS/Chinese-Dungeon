			// 常量 好吧有些已经变成变量了
			let 单元格大小 = 30;
			let 已初始化 = 2;
			let 画布宽度 = Math.min(
			    window.innerWidth - 20,
			    window.innerHeight - 20
			); // 动态宽度
			let 画布高度 = 画布宽度; // 动态高度
			const 房间尺寸范围 = [7, 10];
			const 最大房间数 = 15;
			let 相机显示边长 = 15;
			const 最大堆叠数 = 64;
			let 地牢大小 = 100;
			const 存档版本 = "v1";
			const 游戏版本 = 1526
			document.querySelector('.info-version-tag').innerHTML=`v${游戏版本}`;
			const 所有天气列表 = [
			    "雷暴",
			    "诡魅",
			    "大风",
			    "严寒",
			    "深夜",
			    "深夜",
			];
			const 大风吹动概率 = 0.3;
			let 互动冷却 = false;
			const 怪物移动动画时长 = 300;
			const 数据完整性密钥 = "f_SECRET_KEY_FOR_CHINESE_DUNGEON";
			
			const 调试序列 = ["上", "上", "下", "下", "左", "右", "左", "右"];
			// 单元格类型枚举
			let 当前层数 = 0;
			let 所有地牢层 = new Map(); // 保存各层地牢数据
			
			const 中文对照图标映射 = {
			    药水: "药",
			    钢制长剑: "剑",
			    吸血剑: "吸",
			    橡木法杖: "法",
			    卷轴: "卷",
			    钥匙: "钥",
			    金币: "金",
			    喷火枪: "喷",
			    回旋镖: "回",
			    闪电链法杖: "链",
			    大地猛击锤: "震",
			    穿云箭: "穿",
			    荆棘鞭: "鞭",
			    能量草: "草",
			    秘银锁甲: "翈",
			    真言卷轴: "视",
			    钢制板甲: "甲",
			    金币手枪: "枪",
			    狙击金币枪: "狙",
			    下楼楼梯: "下",
			    上楼楼梯: "上",
			    怪物: "怪",
			    炸弹怪物: "爆",
			    炸弹: "炸",
			    罐子: "罐",
			    锅盖: "锅",
			    盔甲怪物: "魁",
			    敏捷怪物: "速",
			    远攻怪物: "远",
			    仙人掌怪物: "刺",
			    大魔法师: "师",
			    寻宝戒指: "戒",
			    装备按钮: "装",
			    死亡图标: "☠︎",
			    错误: "✘",
			    成功: "✔",
			    缓慢: "慢",
			    冰冻怪物: "㓕",
			    冰盾: "栤",
			    重铸台: "铸",
			    斜方刀: "斜",
			    神秘商人: "商",
			    探险家: "探",
			    祭坛: "坛",
			    互动按钮: "互",
			    背包按钮: "背",
			    卷轴按钮: "卷",
			    HUD常显: "显",
			    HUD智能: "䚐",
			    HUD常隐: "隐",
			    魔法师法杖: "法",
			    符文圈: "符",
			    水晶: "晶",
			    宠物: "宠",
			    熊猫: "態",
			    水母: "鲝",
			    冰霜法杖: "霜",
			    重力锤: "引",
			    剧毒匕首: "毒",
			    大史莱姆: "大",
			    小史莱姆: "小",
			    瞬移怪物: "瞬",
			    伪装怪物: "伪",
			    腐蚀怪物: "蚀",
			    盗贼怪物: "盗",
			    萨满怪物: "萨",
			    召唤师怪物: "召",
			    幽灵仆从: "仆",
			    吸能怪物: "吸",
			    剧毒云雾怪物: "雾",
			    旋风怪物: "旋",
			    旋风: "風",
			    旋风物品: "风",
			    米诺陶: "㸴",
			    折跃门: "门",
			    传送门: "门",
			    毒液: "毒",
			    眩晕: "晕",
			    火焰: "火",
			    引雷针护符: "引",
			    种子: "种",
			    荆棘丛: "荆",
			    灵能盾牌: "灵",
			    恐惧魔杖: "惧",
			    恐惧怪物: "恐",
			    调试工具: "调",
			    恐惧: "恐",
			    冲撞牛角: "角",
			    护卫植物: "卫",
			    远射植物: "远",
			    泉水: "泉",
			    书架: "书",
			    渔网: "网",
			    充能魔杖: "充",
			    时间卷轴: "时",
			    潜行靴子: "潜",
			    钩索: "钩",
			    嗜血战斧: "斧",
			    渔网陷阱: "网",
			    磨刀石: "磨",
			    急救绷带: "绷",
			    照明弹: "照",
			    照明弹光源: "光",
			    挑战石碑: "碑",
			    神龛: "龛",
			    洗身砚: "砚",
			    毒气瓶: "瓶",
			    万能钥匙: "万",
			    陨石法杖: "星",
			    毒气: "毒",
			    落石: "石",
			    地刺: "刺",
			    失明: "盲",
			    召唤陷阱: "召",
			    烈焰陷阱: "焰",
			    虫洞: "洞",
			    障碍物: "障",
			    远射陷阱: "塔",
			    沙漏: "时",
			    时间:"时",
			    脚印:"迹",
			    爱心: "伤",
			    修补心: "心",
			    旗帜: "旗",
			    门: "门",
			    锁: "锁",
			    手形: "改",
			    删除: "删",
			    房间工具: "创",
			    房间编辑: "修",
			    地板: "房",
			    走廊: "廊",
			    墙壁: "墙",
			    告示牌: "牌",
			    超速怪物: "超",
			    复活怪物: "复",
			    娃娃怪物: "娃",
			    吸血鬼: "血",
			    存档点: "存",
			    皇家守卫:"卫",
			    王座守护者:"王",
			    墓碑:"墓",
			    移动弹幕:"弹",
			    奖杯:"奖",
			    陷阱先锋: '探',
			    飞毛腿: '腿',
			    瞬间移动: '瞬',
			    博士之卷: '博',
			    恢复之心: '愈',
			    以牙还牙: '牙',
			    饰品: '饰',
			    分裂怪物: "裂",
			    巨人怪物: "巨",
			    巨人部位: "巨",
			    红蓝开关:"控",
			    红砖块:"█",
			    蓝砖块:"▓",
			    追踪风弹:"颩",
			    刷怪笼: "笼",
			    传送带: "传",
			    巡逻怪物: "巡",
			    同步怪物: "同",
			    绿砖块: "▓",
			    紫砖块: "▒",
			    绿紫开关: "切",
			    开关脉冲器: "脉",
			    复制工具:'拷',
			    沉浸式传送门:'传',
			    卷轴滚动墙: '停',
			    嗅探之鼻:'鼻',
			    永久抗火:'火',
			    永久解冻:'冻',
			    永久力量:'力',
			    永久抗毒:'毒',
			    神偷手: '偷',
			    小书魔:'书',
			    扫帚: '帚',
			    战士: '战',
			    法师: '法',
			    忍者: '忍',
			    游侠:'侠',
			    死灵:'灵',
			    骑士:'骑',
			    磁铁: "磁",
			    蜘蛛怪物: "蛛",
			    反弹怪物: "反",
			    蛛网: "网",
			    魔法师: "麽",
            火蜥蜴: "蜥",
            烟雾弹: "烟",
            烟雾: "雾",
            蜈蚣怪物:"虫",
            定位器地图:"图",
            死灵法杖: "杖",
            骷髅仆从: "骸",
			};
			let 图标映射 = {
			    药水: "🧪",
			    钢制长剑: "🗡️",
			    橡木法杖: "🪄",
			    吸血剑: "🗡️",
			    喷火枪: "💥",
			    冰霜法杖: "🪄",
			    重力锤: "🔨",
			    剧毒匕首: "🐍",
			    卷轴: "📜",
			    钥匙: "🔑",
			    金币: "🪙",
			    锅盖: "🫕",
			    回旋镖: "🪃",
			    闪电链法杖: "🌩️",
			    大地猛击锤: "🔨",
			    穿云箭: "🏹",
			    荆棘鞭: "⛓️",
			    秘银锁甲: "🥼",
			    真言卷轴: "📖",
			    钢制板甲: "🥋",
			    金币手枪: "🔫",
			    狙击金币枪: "🔫",
			    下楼楼梯: "⬇️",
			    上楼楼梯: "⬆️",
			    怪物: "👾",
			    炸弹怪物: "💣",
			    盔甲怪物: "💂",
			    炸弹: "💣",
			    罐子: "🏺",
			    缓慢: "🐌",
			    敏捷怪物: "🏃",
			    远攻怪物: "👼",
			    仙人掌怪物: "🌵",
			    大魔法师: "🧙",
			    寻宝戒指: "💍",
			    装备按钮: "🛡",
			    死亡图标: "💀",
			    错误: "❌",
			    成功: "✅",
			    冰冻怪物: "🧊",
			    冰盾: "❄",
			    重铸台: "⚒️",
			    斜方刀: "💠",
			    神秘商人: "🧙",
			    探险家: "👨‍🌾",
			    祭坛: "🛐",
			    互动按钮: "⚡",
			    背包按钮: "🎒",
			    卷轴按钮: "📜",
			    HUD常显: "👀",
			    HUD智能: "👁️",
			    HUD常隐: "😑",
			    宠物: "🐾",
			    熊猫: "🐼",
			    水母: "🪼",
			    大史莱姆: "🦠",
			    小史莱姆: "🦠",
			    瞬移怪物: "💫",
			    伪装怪物: "👿",
			    腐蚀怪物: "👹",
			    盗贼怪物: "🥷",
			    萨满怪物: "⚕️",
			    召唤师怪物: "🧿",
			    幽灵仆从: "👻",
			    吸能怪物: "😈",
			    剧毒云雾怪物: "☁️",
			    旋风怪物: "🌪️",
			    米诺陶: "🐂",
			    折跃门: "🍥",
			    传送门: "🚪",
			    魔法师法杖: "🔱",
			    符文圈: "⭕",
			    水晶: "💎",
			    毒液: "☢️",
			    能量草: "🌿",
			    旋风: "🌀",
			    旋风物品: "🍃",
			    眩晕: "💫",
			    火焰: "🔥",
			    引雷针护符: "🗼",
			    种子: "🌱",
			    荆棘丛: "🌵",
			    灵能盾牌: "🛡️",
			    恐惧魔杖: "🔮",
			    恐惧怪物: "😨",
			    调试工具: "🛠️",
			    恐惧: "😨",
			    冲撞牛角: "🐂",
			    护卫植物: "🛡️",
			    远射植物: "🎯",
			    泉水: "💧",
			    书架: "📚",
			    渔网: "🕸️",
			    充能魔杖: "🔋",
			    时间卷轴: "⏳",
			    潜行靴子: "👟",
			    钩索: "🪝",
			    嗜血战斧: "🪓",
			    渔网陷阱: "🕸️",
			    磨刀石: "✨",
			    急救绷带: "🩹",
			    照明弹: "🚨",
			    照明弹光源: "💡",
			    挑战石碑: "🏛️",
			    神龛: "⛩️",
			    洗身砚: "🧼",
			    毒气瓶: "⚗️",
			    万能钥匙: "🗝️",
			    陨石法杖: "☄️",
			    毒气: "☣️",
			    落石: "🪨",
			    地刺: "뾰",
			    失明: "🕶️",
			    召唤陷阱: "🧿",
			    烈焰陷阱: "♨️",
			    虫洞: "🌀",
			    障碍物: "🧱",
			    远射陷阱: "🗼",
			    沙漏: "⏳",
			    时间: "⏳",
			    脚印:"👣",
			    爱心: "♥️",
			    修补心: "💔",
			    旗帜: "🚩",
			    门: "🚪",
			    锁: "🔒",
			    手形: "✋",
			    删除: "🗑️",
			    房间工具: "📏",
			    房间编辑: "🏠",
			    地板: "🟩",
			    走廊: "🟫",
			    墙壁: "⬛",
			    告示牌: "🪧",
			    超速怪物: "💨",
			    复活怪物: "🧙🏿‍♂️",
			    娃娃怪物: "👶",
			    吸血鬼: "🧛‍♂️",
			    存档点:"💾",
			    皇家守卫:"💂🏿‍♂️",
			    王座守护者:"⚜️",
			    墓碑:"🪦",
			    移动弹幕:"💀",
			    奖杯:"🏆",
			    陷阱先锋: '🧿',
			    飞毛腿: '👟',
			    瞬间移动: '💫',
			    博士之卷: '🎓',
			    恢复之心: '❤️‍🩹',
			    以牙还牙: '💥',
			    饰品: '💍',
			    分裂怪物: "➗",
			    巨人怪物: "🗿",
			    巨人部位: "🗿",
			    红蓝开关:"🔘",
			    红砖块:"🟥",
			    蓝砖块:"🟦",
			    追踪风弹:"💨",
			    刷怪笼: "⚙️",
			    传送带: "➡️",
			    巡逻怪物: "🚶",
			    同步怪物: "🎯",
			    绿砖块: "🟩",
			    紫砖块: "🟪",
			    绿紫开关: "🟢",
			    开关脉冲器: "📡",
			    复制工具:'📋',
			    沉浸式传送门:"🌀",
			    卷轴滚动墙: '🚫',
			    嗅探之鼻:'👃🏻',
			    永久抗火:'🔥',
			    永久解冻:'🥶',
			    永久力量:'💪🏻',
			    永久抗毒:'🧪',
			    神偷手: '🤏',
			    小书魔:'📖',
			    扫帚: '🧹',
			    战士: '💂‍♀️',
			    法师: '🧙',
			    忍者: '🥷',
			    游侠:'🏹',
			    死灵:'💀',
			    骑士:'🏇',
			    磁铁: "🧲",
			    蜘蛛怪物: "🕷️",
			    反弹怪物: "🪞",
			    蛛网: "🕸️",
			    魔法师: "🧙",
            火蜥蜴: "🦎",
            烟雾弹: "🌫️",
            烟雾: "🌫️",
            蜈蚣怪物:"🐲",
            定位器地图:"🗺️",
            死灵法杖: "🪄",
            骷髅仆从: "💀",
			};
			// 单元格类型枚举
			const 单元格类型 = {
			    墙壁: 0,
			    房间: 1,
			    走廊: 2,
			    门: 3,
			    上锁的门: 4,
			    物品: 5,
			    楼梯下楼: 6,
			    楼梯上楼: 7,
			    怪物: 8,
			};
			const 怪物状态 = {
			    休眠: 0,
			    活跃: 1,
			    攻击: 2,
			};
			const 颜色表 = [
			    "#00FF00", // 绿色
			    "#0000FF", // 蓝色
			    "#FFFF00", // 黄色
			    "#FF00FF", // 品红
			    "#FF0000", // 红色
			    "#800080", //紫色
			];
			const 效果颜色编号映射 = [
			    "#ff0000",
			    "#00ff00",
			    "#2196F3",
			    "#FF9800",
			    "#808080",
			    "#9C27B0",
			    "#008000",
			    "#888888",
			    "#8FBC8F",
			    "#FFEB3B",
			    "#CC5500",
			    "#FFD700",
			    "#8A2BE2",
			    "#A0522D",
			];
			const 效果名称编号映射 = {
			    治疗: 0,
			    能量: 1,
			    神龟: 2,
			    狂暴: 3,
			    隐身: 4,
			    透视: 5,
			    中毒: 6,
			    缓慢: 7,
			    腐蚀: 8,
			    眩晕: 9,
			    火焰: 10,
			    充能: 11,
			    恐惧: 12,
			    牵制: 13,
			};
			const 颜色名表 = ["绿", "蓝", "黄", "品红", "红", "紫"];
			let 楼梯图标 = { 下楼: 图标映射.下楼楼梯, 上楼: 图标映射.上楼楼梯 };
			const 功能键映射 = {
			    1: () => 使用装备槽物品(当前装备页 * 装备栏每页装备数 + 1),
			    2: () => 使用装备槽物品(当前装备页 * 装备栏每页装备数 + 2),
			    3: () => 使用装备槽物品(当前装备页 * 装备栏每页装备数 + 3),
			    4: () => 使用装备槽物品(当前装备页 * 装备栏每页装备数 + 4),
			    5: () => 使用装备槽物品(当前装备页 * 装备栏每页装备数 + 5),
			    6: () => 使用装备槽物品(当前装备页 * 装备栏每页装备数 + 6),
			    7: () => 使用装备槽物品(当前装备页 * 装备栏每页装备数 + 7),
			    q: () => 处理HUD切换按钮点击(),
			    e: () => {
			        界面可见性.背包 = !界面可见性.背包;
			        切换背包显示();
			    },
			    g: () => 切换日志显示(),
			    f: () => 尝试互动(),
			    z: () => 导出存档(),
			    t: () => 打开传送菜单(),
			    j: () => {
			        切换装备页(-1);
			    },
			    k: () => {
			        切换装备页(1);
			    },
			    u: () => 玩家死亡(),
			    r: () => 重置创意关卡(),
			    c: () => 打开配方书(),
			};
			const 物品生成配置 = {
			    基础概率: {
			        普通房间: 0.4,
			        上锁房间: 0.7,
			    },
			    品质权重: {
			        1: [60, 0], // 品质: [基础刷新概率,随层数增长的附加刷新概率]
			        2: [25, 20],
			        3: [10, 30],
			        4: [5, 40],
			        5: [0, 10],
			    },
			    类型分布: {
			        普通房间: [
			            { 类型: "武器", 权重: 40 },
			            { 类型: "防具", 权重: 30 },
			            { 类型: "药水", 权重: 20 },
			            { 类型: "卷轴", 权重: 10 },
			            { 类型: "工具", 权重: 25 },
			            { 类型: "宠物", 权重: 10 },
			            { 类型: "饰品", 权重: 8 },
			        ],
			        上锁房间: [
			            { 类型: "卷轴", 权重: 30 },
			            { 类型: "武器", 权重: 30 },
			            { 类型: "药水", 权重: 25 },
			            { 类型: "防具", 权重: 15 },
			            { 类型: "工具", 权重: 25 },
			            { 类型: "宠物", 权重: 10 },
			            { 类型: "饰品", 权重: 10 },
			        ],
			    },
			};
			
			const 创建物品池 = () => ({
			    武器: [
			        { 类: 荆棘种子, 品质: 1, 最小层: 1 },
			        { 类: 护卫种子, 品质: 2, 最小层: 1 },
			        { 类: 远射种子, 品质: 3, 最小层: 2 },
			        { 类: 吸能种子, 品质: 2, 最小层: 1 },
			        { 类: 橡木法杖, 品质: 2, 最小层: 3 },
			        { 类: 钢制长剑, 品质: 1, 最小层: 0 },
			        { 类: 吸血剑, 品质: 1, 最小层: 0 },
			        { 类: 喷火枪, 品质: 1, 最小层: 0 },
			        { 类: 炸弹, 品质: 2, 最小层: 1 },
			        { 类: 金币手枪, 品质: 3, 最小层: 2 },
			        { 类: 回旋镖, 品质: 2, 最小层: 1 },
			        { 类: 闪电链法杖, 品质: 3, 最小层: 3 },
			        { 类: 大地猛击锤, 品质: 3, 最小层: 3 },
			        { 类: 穿云箭, 品质: 2, 最小层: 2 },
			        { 类: 荆棘鞭, 品质: 1, 最小层: 1 },
			        { 类: 冰霜法杖, 品质: 3, 最小层: 2 },
			        { 类: 重力锤, 品质: 4, 最小层: 5 },
			        { 类: 剧毒匕首, 品质: 1, 最小层: 1 },
			        { 类: 神秘商人, 品质: 1, 最小层: 1 }, // 奸商武力值要高，所以在武器类（确信）
			        { 类: 恐惧魔杖, 品质: 3, 最小层: 4 },
			        { 类: 斜方刀, 品质: 2, 最小层: 1 },
			        { 类: 充能魔杖, 品质: 4, 最小层: 6 },
			        { 类: 嗜血战斧, 品质: 4, 最小层: 4 },
			        { 类: 陨石法杖, 品质: 4, 最小层: 6 },
			        { 类: 狙击金币枪, 品质: 2, 最小层: 4 },
			        { 类: 追踪风弹, 品质: 3, 最小层: 4 },
			        { 类: 死灵法杖, 品质: 2, 最小层: 7 },
			        { 类: 扫帚, 品质: 2, 最小层: 2 },
			    ],
			    工具: [
			        { 类: 能量熔炉, 品质: 3, 最小层: 4 },
			        { 类: 物品祭坛, 品质: 1, 最小层: 0 },
			        { 类: 耐久祭坛, 品质: 2, 最小层: 0 },
			        { 类: 背包扩容祭坛, 品质: 2, 最小层: 0 },
			        { 类: 重铸台, 品质: 3, 最小层: 2 },
			        { 类: 探险家, 品质: 1, 最小层: 1 },
			        { 类: 火把, 品质: 1, 最小层: 2 },
			        { 类: 罐子, 品质: 1, 最小层: 0 },
			        { 类: 渔网, 品质: 2, 最小层: 1 },
			        { 类: 钩索, 品质: 3, 最小层: 2 },
			        { 类: 急救绷带, 品质: 2, 最小层: 1 },
			        { 类: 磨刀石, 品质: 3, 最小层: 2},
			        { 类: 照明弹, 品质: 2, 最小层: 2},
			        { 类: 挑战石碑, 品质: 4, 最小层: 3},
			        { 类: 神龛, 品质: 5, 最小层: 2},
			        { 类: 洗身砚, 品质: 4, 最小层: 3 },
			        { 类: 毒气瓶, 品质: 2, 最小层: 2 },
			        { 类: 万能钥匙, 品质: 3, 最小层: 3 },
			        { 类: 便携障碍物, 品质: 1, 最小层: 0 },
			        { 类: 时空罗盘, 品质: 5, 最小层: 8 },
			        { 类: 神偷手, 品质: 4, 最小层: 2 },
			        { 类: 磁铁, 品质: 3, 最小层: 2 },
			        { 类: 烟雾弹, 品质: 3, 最小层: 3 },
			        { 类: 定位器地图, 品质: 1, 最小层: 0 },
			    ],
			    防具: [
			        { 类: 引雷针护符, 品质: 3, 最小层: 2 },
			        { 类: 钢制板甲, 品质: 2, 最小层: 0 },
			        { 类: 锅盖, 品质: 2, 最小层: 0 },
			        { 类: 秘银锁甲, 品质: 4, 最小层: 2 },
			        { 类: 冰盾, 品质: 1, 最小层: 1 },
			        { 类: 潜行靴子, 品质: 2, 最小层: 4 },
			        { 类: 守卫者盔甲, 品质: 4, 最小层: 5 },
			    ],
			    药水: [
			        { 类: 治疗药水, 品质: 2, 最小层: 0 },
			        { 类: 狂暴药水, 品质: 2, 最小层: 0 },
			        { 类: 神龟药水, 品质: 3, 最小层: 1 },
			        { 类: 能量药水, 品质: 4, 最小层: 1 },
			        { 类: 隐身药水, 品质: 3, 最小层: 2 },
			        { 类: 透视药水, 品质: 3, 最小层: 1 },
			    ],
			    卷轴: [
			        { 类: 迅捷卷轴, 品质: 2, 最小层: 0 },
			        { 类: 清净卷轴, 品质: 2, 最小层: 0 },
			        { 类: 跃迁卷轴, 品质: 3, 最小层: 2 },
			        { 类: 真言卷轴, 品质: 4, 最小层: 4 },
			        { 类: 湮灭卷轴, 品质: 1, 最小层: 0 },
			        { 类: 贪婪卷轴, 品质: 3, 最小层: 3 },
			        { 类: 神秘卷轴, 品质: 1, 最小层: 0 },
			        { 类: 附魔卷轴, 品质: 1, 最小层: 1 },
			        { 类: 时间卷轴, 品质: 4, 最小层: 5 },
			        { 类: 易位卷轴, 品质: 4, 最小层: 4 },
			    ],
			    宠物: [
			        { 类: 熊猫, 品质: 3, 最小层: 2 },
			        { 类: 水母, 品质: 4, 最小层: 2 },
			        { 类: 火蜥蜴, 品质: 4, 最小层: 4 },
			    ],
			    饰品: [
			        { 类: 陷阱先锋饰品, 品质: 3, 最小层: 3 },
			        { 类: 飞毛腿饰品, 品质: 2, 最小层: 2 },
			        { 类: 瞬间移动饰品, 品质: 4, 最小层: 5 },
			        { 类: 博士之卷饰品, 品质: 3, 最小层: 2 },
			        { 类: 恢复之心饰品, 品质: 2, 最小层: 2 },
			        { 类: 以牙还牙饰品, 品质: 4, 最小层: 4 },
			        { 类: 嗅探之鼻饰品, 品质: 3, 最小层: 2 },
			    ],
			});
			
			const 创建怪物池 = () => ({
			    普通房间: [
			        { 类: 怪物, 权重: 45, 最小层: 0 },
			        { 类: 盔甲怪物, 权重: 30, 最小层: 0 },
			        { 类: 敏捷怪物, 权重: 15, 最小层: 2 },
			        { 类: 远攻怪物, 权重: 25, 最小层: 1 },
			        { 类: 炸弹怪物, 权重: 15, 最小层: 3 },
			        { 类: 冰冻怪物, 权重: 15, 最小层: 2 },
			        { 类: 仙人掌怪物, 权重: 25, 最小层: 1 },
			        { 类: 大史莱姆怪物, 权重: 15, 最小层: 2 },
			        { 类: 瞬移怪物, 权重: 10, 最小层: 3 },
			        { 类: 伪装怪物, 权重: 8, 最小层: 1 },
			        { 类: 腐蚀怪物, 权重: 12, 最小层: 2 },
			        { 类: 盗贼怪物, 权重: 10, 最小层: 4 },
			        { 类: 萨满怪物, 权重: 7, 最小层: 3 },
			        { 类: 召唤师怪物, 权重: 7, 最小层: 4 },
			        { 类: 吸能怪物, 权重: 11, 最小层: 1 },
			        { 类: 剧毒云雾怪物, 权重: 9, 最小层: 2 },
			        { 类: 旋风怪物, 权重: 10, 最小层: 4 },
			        { 类: 恐惧怪物, 权重: 10, 最小层: 3 },
			        { 类: 超速怪物, 权重: 12, 最小层: 4 },
			        { 类: 复活怪物, 权重: 14, 最小层: 5 },
			        { 类: 吸血鬼, 权重: 8, 最小层: 0 },
			        { 类: 分裂怪物, 权重: 10, 最小层: 6 },
			        { 类: 巨人怪物, 权重: 12, 最小层: 7 },
			        { 类: 巡逻怪物, 权重: 5, 最小层: 7 },
			        { 类: 反弹怪物, 权重: 20, 最小层: 2 },
			        { 类: 蜘蛛怪物, 权重: 25, 最小层: 1 },
			        { 类: 魔法师, 权重: 8, 最小层: 6 },
			        { 类: 蜈蚣怪物, 权重: 12, 最小层: 5 },
			    ],
			    上锁房间: [
			        { 类: 炸弹怪物, 权重: 35, 最小层: 1 },
			        { 类: 远攻怪物, 权重: 30, 最小层: 3 },
			        { 类: 敏捷怪物, 权重: 35, 最小层: 2 },
			        { 类: 冰冻怪物, 权重: 15, 最小层: 0 },
			        { 类: 盔甲怪物, 权重: 30, 最小层: 0 },
			        { 类: 仙人掌怪物, 权重: 30, 最小层: 1 },
			        { 类: 大史莱姆怪物, 权重: 20, 最小层: 2 },
			        { 类: 瞬移怪物, 权重: 15, 最小层: 3 },
			        { 类: 伪装怪物, 权重: 12, 最小层: 1 },
			        { 类: 腐蚀怪物, 权重: 18, 最小层: 2 },
			        { 类: 盗贼怪物, 权重: 18, 最小层: 1 },
			        { 类: 萨满怪物, 权重: 5, 最小层: 3 },
			        { 类: 召唤师怪物, 权重: 4, 最小层: 4 },
			        { 类: 吸能怪物, 权重: 9, 最小层: 1 },
			        { 类: 剧毒云雾怪物, 权重: 7, 最小层: 2 },
			        { 类: 旋风怪物, 权重: 12, 最小层: 3 },
			        { 类: 恐惧怪物, 权重: 15, 最小层: 3 },
			        { 类: 超速怪物, 权重: 15, 最小层: 4 },
			        { 类: 复活怪物, 权重: 10, 最小层: 2 },
			        { 类: 吸血鬼, 权重: 8, 最小层: 0 },
			        { 类: 分裂怪物, 权重: 15, 最小层: 6 },
			        { 类: 巨人怪物, 权重: 15, 最小层: 7 },
			        { 类: 巡逻怪物, 权重: 5, 最小层: 7 },
			        { 类: 反弹怪物, 权重: 25, 最小层: 2 },
			        { 类: 蜘蛛怪物, 权重: 25, 最小层: 1 },
			        { 类: 蜈蚣怪物, 权重: 15, 最小层: 5 },
			    ],
			});
			const 融合Buff类型 = {
			    攻击加成: "ATTACK_BONUS",
			    攻击倍率: "ATTACK_MULTIPLIER",
			    冷却缩减: "COOLDOWN_REDUCTION",
			    冷却倍率: "COOLDOWN_MULTIPLIER",
			    耐久加成: "DURABILITY_BONUS",
			    耐久倍率: "DURABILITY_MULTIPLIER",
			    范围加成: "RANGE_BONUS",
			    中毒几率: "POISON_CHANCE",
			    火焰伤害: "FIRE_DAMAGE_CHANCE",
			    冰冻几率: "ICE_CHANCE",
			    生命偷取: "LIFE_STEAL",
			    防御加成: "DEFENSE_BONUS",
			    防御倍率: "DEFENSE_MULTIPLIER",
			    暴击几率: "CRITICAL_CHANCE",
			    暴击伤害倍率: "CRITICAL_DAMAGE_MULTIPLIER",
			    击退几率: "KNOCKBACK_CHANCE",
			    攻击吸能: "ENERGY_STEAL_ON_HIT",
			    闪避几率: "DODGE_CHANCE",
			    固定伤害减免: "FLAT_DAMAGE_REDUCTION",
			    受击回能: "ENERGY_ON_DAMAGE_TAKEN",
			    幸运一击: "LUCKY_STRIKE",
			    协同效应: "SYNERGY_EFFECT",
			    磨刀石攻击加成: "SHARPEN_ATTACK_BONUS",
			    磨刀石冷却缩减: "SHARPEN_COOLDOWN_REDUCTION",
			};
			            const 神龛效果列表 = [
			    {
			        id: '祝福_最大生命值',
			        名称: '生命祝福',
			        描述: '你的体魄变得更加强健，最大生命值永久提升了25点。',
			        类型: '祝福',
			        apply: () => {
			            永久Buffs.最大生命值加成 = (永久Buffs.最大生命值加成 || 0) + 25;
			            应用永久Buffs();
			        },
			        deapply: () => {
			            永久Buffs.最大生命值加成 = -永久Buffs.最大生命值加成;
			        }
			    },
			    {
			        id: '祝福_挖掘墙壁',
			        名称: '开山之力',
			        描述: '你获得了开山之力，现在可以挖掘墙壁了！',
			        类型: '祝福',
			        apply: () => {
			            永久Buffs.能挖掘墙壁 = true;
			            应用永久Buffs();
			        }
			    },
			    {
			        id: '祝福_永久攻击',
			        名称: '战神之赐',
			        描述: '武运昌隆！你的基础攻击力永久提升了2点。',
			        类型: '祝福',
			        apply: () => {
			            永久Buffs.攻击加成 = (永久Buffs.攻击加成 || 0) + 2;
			            应用永久Buffs();
			        }
			    },
			     {
			        id: '祝福_初始能量',
			        名称: '启迪之心',
			        描述: '你的心智变得更加敏锐，每层开始时都会获得额外的初始能量。',
			        类型: '祝福',
			        apply: () => {
			            永久Buffs.初始能量加成 = (永久Buffs.初始能量加成 || 0) + 20;
			            应用永久Buffs();
			        }
			    },
			    {
			        id: '祝福_装备耐久',
			        名称: '工匠之魂',
			        描述: '你的装备似乎变得更加坚固，所有装备的耐久度消耗降低25%。',
			        类型: '祝福',
			        apply: () => {
			            const i=永久Buffs.耐久消耗减免 || 0;
			            永久Buffs.耐久消耗减免 = i+(Math.pow(1-i,2))/4
			            应用永久Buffs();
			        }
			    },
			    {
			        id: '诅咒_随机掉落',
			        名称: '失物之咒',
			        描述: '你的口袋似乎有个破洞，移动时偶尔会随机掉落背包中的物品！',
			        类型: '诅咒',
			        apply: () => {
			            永久Buffs.随机掉落 = true;
			            应用永久Buffs();
			        }
			    },
			    {
			        id: '诅咒_挑战增加',
			        名称: '好战之血',
			        描述: '你变得更好战了，所有挑战房间的波数都将永久增加2波。',
			        类型: '诅咒',
			        apply: () => {
			            永久Buffs.挑战波数增加 = (永久Buffs.挑战波数增加 || 0) + 2;
			            应用永久Buffs();
			        }
			    },
			    {
			        id: '诅咒_怪物反伤',
			        名称: '荆棘诅咒',
			        描述: '你的攻击似乎会激怒地牢的意志，所有怪物现在都会反弹少量伤害给你。',
			        类型: '诅咒',
			        apply: () => {
			            永久Buffs.怪物反伤 = true;
			            应用永久Buffs();
			        }
			    },
			     {
			        id: '诅咒_能量流失',
			        名称: '遗忘之咒',
			        描述: '你的精神不再集中，每回合都会缓慢流失少量能量。',
			        类型: '诅咒',
			        apply: () => {
			            永久Buffs.能量流失 = (永久Buffs.能量流失 || 0) + 0.2;
			            应用永久Buffs();
			        }
			    },
			    {
			        id: '诅咒_商店涨价',
			        名称: '奸商之友',
			        描述: '神秘商人们似乎达成了共识，他们所有商品的价格都上涨了。',
			        类型: '诅咒',
			        apply: () => {
			            永久Buffs.商店价格倍率 = (永久Buffs.商店价格倍率 || 0.2) * 1.5;
			            应用永久Buffs();
			        }
			    },
			    {
			        id: '诅咒_耐久减半',
			        名称: '腐朽之触',
			        描述: '一股腐朽的力量侵蚀了你的装备，所有装备的耐久度立即减半！',
			        类型: '诅咒',
			        apply: () => {
			            [...玩家背包.values(), ...玩家装备.values()].forEach(item => {
			                if (item && item.自定义数据 && item.自定义数据.has('耐久') && !item.自定义数据.get('不可破坏')) {
			                    const 当前耐久 = item.自定义数据.get('耐久');
			                    item.自定义数据.set('耐久', Math.ceil(当前耐久 / 2));
			                }
			            });
			            更新装备显示();
			            更新背包显示();
			        }
			    }
			];
			
			
